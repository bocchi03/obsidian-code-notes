# 第七章 无线网络和移动网络

## 7.1 概述

### 无线通信的重要性
无线网络（如WiFi、蜂窝网络）是现代通信的核心，支撑多种应用：
- **移动计算**：智能手机、平板电脑和笔记本电脑依赖无线连接访问互联网。
- **物联网（IoT）**：智能恒温器、可穿戴设备和传感器通过无线通信互联。
- **智能基础设施**：智能家居、城市和自动驾驶汽车等依赖可靠的无线网络。

### 无线网络与有线网络的主要区别
无线网络和有线网络在以下方面存在显著差异：
- **物理介质**：有线网络使用电缆（如以太网、光纤），而无线网络通过空气中的无线电波传输信号。
- **错误率**：无线网络的误码率（BER）较高（10⁻³到10⁻⁵），而有线网络误码率极低（10⁻⁹或更低）。
- **干扰**：无线信号容易受到其他设备（蓝牙、微波炉）或物理障碍的干扰。
- **安全性**：无线信号是广播式传输，相比有线网络更容易被窃听。

### 无线链路的独特挑战
无线通信因无线电波传播特性面临以下挑战：
- **多径传播**：信号遇到障碍物（如墙壁、建筑物）时发生反射、折射，导致多个信号版本同时到达接收器，造成干扰。
  - **示例**：在城市环境中，手机信号从基站发出后反射到建筑物，导致接收器接收到重叠信号。
- **干扰**：来自其他无线设备或电磁噪声的信号会降低信号质量。
  - **示例**：WiFi路由器与微波炉共用2.4 GHz频段时，微波炉运行会降低WiFi性能。
- **信道动态变化**：用户移动、天气或环境变化导致信号强度波动。
  - **示例**：用户在建筑物内走动时，远离接入点（AP）或遇到墙壁会导致信号衰减。

---

## 7.2 无线链路和网络特性

### 带宽与速率变化
无线链路的带宽受多种因素影响，导致速率高度可变：
- **信号质量**：信噪比（SNR）决定可用的数据速率。SNR越高，可使用更高阶的调制方式（如64-QAM而非QPSK）。
- **速率自适应**：协议（如IEEE 802.11）根据信道条件动态调整数据速率。
  - **示例**：802.11n WiFi连接在用户远离AP时，可能从150 Mbps降至54 Mbps，因SNR降低。

![image-20250428200435019](C:\Users\朱仲艺\AppData\Roaming\Typora\typora-user-images\image-20250428200435019.png

![image-20250502180819585](C:\Users\朱仲艺\AppData\Roaming\Typora\typora-user-images\image-20250502180819585.png)

### 无线链路的错误处理
无线链路的误码率较高，需要强大的错误处理机制：
- **前向纠错（FEC）**：通过添加冗余数据在接收端纠正错误，无需重传。
- **自动重传请求（ARQ）**：接收器检测到错误帧后请求重传。
  - **示例**：在WiFi中，若数据帧损坏，接收器不发送ACK，触发发送方重传。
- **混合ARQ（HARQ）**：结合FEC和ARQ，提高效率，广泛用于4G/5G。

### 隐蔽节点问题
隐蔽节点问题指两个节点都能与AP通信，但彼此无法感知，导致发送冲突。
- **场景**：节点A和C都能与AP B通信，但A和C相距太远，无法检测对方的信号。若A和C同时发送，信号在B处冲突。
- **解决方案**：**RTS/CTS（请求发送/清除发送）协议**：
  1. 节点A向AP B发送RTS帧。
  2. AP B回复CTS帧，附近所有节点（包括C）都能接收。
  3. 节点C暂停发送，避免冲突。
- **权衡**：RTS/CTS增加开销，在低流量场景下可能降低吞吐量。

![image-20250429202921575](C:\Users\朱仲艺\AppData\Roaming\Typora\typora-user-images\image-20250429202921575.png)

### 暴露节点问题
暴露节点问题指节点因听到其他节点的发送而错误地避免发送，即使其发送不会干扰。
- **场景**：节点B正在向节点A发送数据。节点C能听到B的信号，想向节点D发送数据，但因担心干扰而等待。然而，C到D的发送不会影响B到A的通信。
- **影响**：降低网络效率，限制并发传输。
- **缓解方法**：高级调度或定向天线可减少影响，但802.11未完全解决此问题。

---

## 7.3 WiFi：IEEE 802.11 无线局域网

### 7.3.1 802.11 架构
IEEE 802.11（WiFi）是一组用于无线局域网（WLAN）的标准，其架构包括：
- **基本服务集（BSS）**：一组无线设备通过单个接入点（AP）通信。
  - **示例**：家庭WiFi网络，包括一个路由器（AP）和连接的设备（笔记本电脑、手机）。
- **扩展服务集（ESS）**：多个BSS通过分布系统（DS，通常是有线骨干网）互联。
  - **示例**：大学校园WiFi网络，多个AP覆盖不同楼宇，支持无缝漫游。
- **接入点（AP）**：桥接无线设备与有线网络，负责帧转发、认证等功能。

![image-20250429203007386](C:\Users\朱仲艺\AppData\Roaming\Typora\typora-user-images\image-20250429203007386.png)

### 7.3.2 802.11 MAC协议
**介质访问控制（MAC）**协议使用**CSMA/CA（带冲突避免的载波侦听多路访问）**管理共享无线介质的访问：
- **运行机制**：
  1. 节点侦听信道（载波侦听）。
  2. 若信道空闲，经过短帧间间隙（DIFS）后发送。
  3. 若信道忙碌，等待信道空闲，然后随机选择退避时间（基于竞争窗口）。
  4. 节点在信道空闲时递减退避计时器，计时器归零时发送。
- **冲突避免**：与以太网的CSMA/CD不同，WiFi通过随机退避和可选的RTS/CTS避免冲突。

- **RTS(请求发送)/CTS(允许发送)机制**：
  - 用于大帧传输，减少冲突影响。
  - **示例**：节点发送RTS帧（20字节），AP回复CTS帧（14字节）。其他节点延迟发送，确保数据帧无冲突传输。
  - ![image-20250429203526124](C:\Users\朱仲艺\AppData\Roaming\Typora\typora-user-images\image-20250429203526124.png)
- **确认（ACK）**：
  - 数据帧成功接收后，接收方发送ACK确认。
  - 若未收到ACK，发送方在超时后重传。
- **二进制指数退避**：
  - 发生冲突（通过缺失ACK推断）后，竞争窗口大小加倍（如从32个时隙增至64个时隙），降低重复冲突概率。
  - **示例**：两次冲突后，竞争窗口可能增至128个时隙，增加平均等待时间。

### 7.3.3 IEEE 802.11 物理层
物理层定义数据在无线介质上的传输方式，主要特点包括：
- **标准与速率**：
  - **802.11b**：2.4 GHz，最高11 Mbps，使用DSSS（直接序列扩频）。
  - **802.11g**：2.4 GHz，最高54 Mbps，使用OFDM（正交频分复用）。
  - **802.11n**：2.4/5 GHz，最高600 Mbps，使用MIMO（多输入多输出）和信道绑定。
  - **802.11ac**：5 GHz，最高1.3 Gbps，使用更宽信道（80 MHz）和高阶调制。
  - **802.11ax (Wi-Fi 6)**：2.4/5 GHz，最高9.6 Gbps，优化高密度环境，支持OFDMA和MU-MIMO。
- **调制技术**：
  - **DSSS**：将信号扩展到更宽频带，增强鲁棒性（用于802.11b）。
  - **OFDM**：将信道划分为多个子载波，提高效率（用于802.11g及后续标准）。
  - **示例**：802.11ac使用256-QAM（每符号8比特），相比802.11b的BPSK（每符号1比特）显著提高吞吐量。

### 7.3.4 在同一IP子网中漫游
WiFi支持在同一ESS内无缝移动，无需更改设备的IP地址：
- **重新关联过程**：
  1. 设备检测到新AP的信号更强。
  2. 向新AP发送重新关联请求，新AP通过DS与旧AP协调。
  3. 设备保持原有IP地址和会话。
- **示例**：用户从大学校园一端走到另一端，在同一ESS内切换AP，IP地址不变，视频流未中断。
- **挑战**：快速重新关联对实时应用（如VoIP）至关重要，避免延迟。

![image-20250429203739662](C:\Users\朱仲艺\AppData\Roaming\Typora\typora-user-images\image-20250429203739662.png)

### 7.3.5 802.11高级功能
现代WiFi标准引入高效功能：
- **MIMO（多输入多输出）**：
  - 使用多根天线同时发送和接收数据，提高吞吐量和可靠性。
  - **示例**：802.11n AP使用4x4 MIMO，传输四条空间流，达到600 Mbps。
- **帧聚合**：
  - 将多个MAC帧合并为一个物理帧，减少开销。
  - **类型**：A-MPDU（聚合MAC协议数据单元）和A-MSDU（聚合MAC服务数据单元）。
  - **示例**：802.11n将十个1500字节帧聚合成一个15,000字节帧，降低头部开销。

### 7.3.6 WiFi个人热点和安全性
- **个人热点**：
  - 设备（如智能手机）可充当AP，共享其蜂窝网络连接。
  - **示例**：手机创建热点，允许笔记本电脑通过手机的4G连接上网。
  - **挑战**：热点耗电量大，带宽可能受限。
- **安全协议**：
  - **WEP（有线等效加密）**：已过时，加密弱，几分钟内可破解。
  - **WPA/WPA2（WiFi保护访问）**：使用更强加密（WPA用TKIP，WPA2用AES）和动态密钥。
  - **WPA3**：2018年推出，提供更强加密（SAE协议）和防暴力破解保护。
  - **示例**：咖啡店WiFi使用WPA2-PSK共享密码，确保客户端与AP间通信加密。

---

## 7.4 蜂窝网络：4G和5G

### 7.4.1 4G LTE架构和组件
**长期演进（LTE）**是4G标准，旨在提供高速、低延迟的移动通信。其架构包括：
- **eNodeB（演进型节点B）**：基站，直接与用户设备（UE，如智能手机）通信。
  - **功能**：无线资源管理、调度和切换协调。
- **演进分组核心（EPC）**：核心网络，处理数据和信令：
  - **MME（移动管理实体）**：管理UE注册、认证和切换。
  - **SGW（服务网关）**：在eNodeB与互联网之间路由数据。
  - **PGW（分组数据网络网关）**：连接EPC与外部网络（如互联网），分配IP地址。
- **示例**：用户观看视频时，eNodeB向UE传输数据，SGW通过EPC转发，PGW连接到视频服务器。

### 7.4.2 LTE协议栈
LTE协议栈管理UE与网络的通信：
- **RRC（无线资源控制）**：处理连接建立、移动性和资源分配。
- **PDCP（分组数据汇聚协议）**：执行头部压缩和加密。
- **RLC（无线链路控制）**：分段和重组数据，处理重传。
- **MAC（介质访问控制）**：调度传输，管理HARQ。
- **PHY（物理层）**：编码和调制数据以进行空中传输。
- **示例**：发送电子邮件时，PDCP压缩邮件头部，RLC分段数据，MAC调度传输。

### 7.4.3 LTE无线接入网
**无线接入网（RAN）**管理无线通信：
- **空口技术**：
  - **下行链路**：使用**OFDMA（正交频分多址）**为多个用户分配子载波。
  - **上行链路**：使用**SC-FDMA（单载波频分多址）**，提高UE的功率效率。
- **资源块（RB）**：
  - 资源块是时间-频率单元（0.5 ms x 180 kHz），动态分配给用户。
  - **示例**：下载文件的用户可能分配50个RB，而VoIP用户分配10个RB以确保低带宽高优先级。
- **调度**：eNodeB根据信道质量和QoS需求调度RB。

### 7.4.4 LTE高级功能
- **切换与小区重选**：
  - 切换确保UE在eNodeB间移动时无缝连接。
  - **示例**：火车上的用户在切换基站时保持通话不中断。
- **EPS承载**：
  - 为不同流量类型（语音、视频、数据）定义QoS。
  - **示例**：视频流承载具有更高带宽和更低延迟，相比电子邮件承载。

### 7.4.5 全球蜂窝网络与漫游
- **国际漫游**：
  - 运营商间的协议允许UE连接到外国网络。
  - **示例**：从美国到欧洲旅行的用户连接到当地4G网络，数据通过其国内运营商的PGW路由。
- **协议**：**GTP（GPRS隧道协议）**和**Diameter**协议管理漫游和计费。

### 7.4.6 5G网络
**5G**在4G基础上提供增强功能：
- **关键特性**：
  - **eMBB（增强移动宽带）**：支持4K流媒体等高带宽应用。
  - **URLLC（超可靠低延迟通信）**：支持关键任务应用（如自动驾驶）。
  - **mMTC（大规模机器类通信）**：连接数百万物联网设备。
- **新技术**：
  - **毫米波**：使用高频段（24–100 GHz）提供巨大带宽。
  - **网络切片**：为特定应用创建虚拟网络（如物联网切片、游戏切片）。
  - **MEC（多接入边缘计算）**：在靠近用户的位置处理数据，降低延迟。
- **示例**：自动驾驶的5G网络切片确保低于1ms的延迟，而物联网切片优化低功耗。

---

## 7.5 移动性管理原理

### 7.5.1 设备移动性：网络层视角
移动性对网络层带来挑战：
- **IP地址变更**：设备移动到新子网时通常需要新IP地址，破坏现有会话。
  - **示例**：笔记本电脑从家庭WiFi切换到咖啡店WiFi，若无移动性协议，TCP连接将中断。

### 7.5.2 移动IP
**移动IP**允许设备在漫游时保留其家乡IP地址：
- **组件**：
  - **家乡代理（HA）**：家乡网络中的路由器，跟踪设备位置。
  - **外地代理（FA）**：访问网络中的路由器，分配转交地址（CoA）。
- **过程**：
  1. 设备通过FA向HA注册其CoA。
  2. HA使用IP-in-IP封装将数据包隧道传输到CoA。
  3. 设备直接向通信对方发送数据包（直接路由）。
- **三角路由问题**：
  - 通信对方的包通过HA转发，增加延迟。
  - **优化**：路由优化允许直接通信，但需额外信令。
- **示例**：出差员工的笔记本使用移动IP，无论连接到哪个网络，都能以相同IP地址访问公司服务器。

### 7.5.3 无缝移动性的直接支持
- **隧道技术**：
  - **GRE（通用路由封装）**和**IP-in-IP**通过封装数据包保持会话连续性。
  - **示例**：4G网络中，UE在eNodeB间移动，数据通过SGW隧道传输，保持IP地址不变。
- **代理解决方案**：
  - **PMIP（代理移动IP）**代表设备处理移动性信令，降低UE复杂性。

---

## 7.6 移动性管理实践

### 7.6.1 4G/5G网络中的移动性管理
- **4G LTE**：
  - 使用X2和S1接口实现eNodeB间切换。
  - **示例**：UE在小区间移动时触发X2切换，数据包丢失极少。
- **5G**：
  - 引入**N2/N3接口**和**AMF（接入与移动性管理功能）**，实现更快的切换。
  - 支持**双连接**（同时连接4G和5G），确保平滑过渡。

### 7.6.2 移动IP的实际应用
- **增强功能**：
  - **安全性**：结合IPsec实现安全隧道。
  - **压缩**：通过头部压缩降低隧道开销。
  - **MPTCP（多路径TCP）**：使用多条网络路径（如WiFi和蜂窝）提高鲁棒性。
- **示例**：视频会议应用使用MPTCP在WiFi和5G间切换，不中断通话。

---

## 7.7 无线与移动性对高层协议的影响

### TCP性能问题
无线网络对TCP性能造成影响：
- **高丢包率**：TCP将丢包误判为拥塞，错误地降低发送速率。
  - **示例**：无线链路10%的丢包率导致TCP将拥塞窗口减半，尽管丢包由干扰引起。
- **可变延迟**：移动性引起的切换导致抖动，影响实时应用。

### 适配策略
- **Snoop协议**：
  - AP上的代理缓存TCP数据包，局部重传丢失包，避免端到端重传。
  - **示例**：WiFi AP的Snoop代理重传丢失包给笔记本电脑，避免TCP超时。
- **分割TCP**：
  - 将TCP连接分为有线和无线段，分别优化。
- **TCP变种**：
  - **TCP Westwood**：估算带宽，避免丢包时过度降低速率。
  - **示例**：在4G链路5%丢包率下，TCP Westwood比标准TCP保持更高吞吐量。

---

## 7.8 小结
- **无线网络**：与有线网络在介质、错误率和干扰方面不同，需专用协议如CSMA/CA和OFDMA。
- **移动性管理**：通过移动IP、隧道和4G/5G切换机制实现无缝连接。
- **5G创新**：提供高速、低延迟和大规模连接，支持新应用。
- **协议影响**：无线挑战需TCP适配，如Snoop和Westwood。

---

## 课后复习题与练习
1. **无线链路错误处理**：
   - 解释无线链路为何比有线链路误码率高。描述两种错误处理机制，并为每种在802.11中举例。
2. **802.11 MAC协议**：
   - 详细说明802.11中CSMA/CA的步骤，包括RTS/CTS和指数退避的作用。用涉及三个节点的场景说明。
3. **LTE与5G架构对比**：
   - 比较LTE的eNodeB与5G的gNodeB角色。列举两项5G特性（如网络切片、毫米波）及其优势。

---

这些笔记内容详尽，涵盖了理论、协议、实际应用和示例，适合深入学习或作为教学材料。如需进一步调整或补充，请告知！